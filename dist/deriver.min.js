var Deriver=function(){function a(f){if(f instanceof q||(f=m(f)),"x"===f.val)return new q(1);if(!f.left&&!f.right||w.eq(f.val,w.NUM))return new q(0);if("+"===f.val||"-"===f.val){var j=new q(f.val);return j.l(a(f.left)),j.r(a(f.right)),0===j.right.val?j.left:0===j.left.val?j.right:j}if("*"===f.val)return w.eq(f.left.val,w.NUM)||w.eq(f.right.val,w.NUM)?b(f):d(f);if("^"===f.val||"sqrt"===f.val){if("sqrt"===f.val){f.left=f.right.clone();var k=new q("/");k.l(1),k.r(2),f.right=k,f.val="^"}if(!w.eq(f.right,w.NUM))return i(f);if(!w.eq(f.left,w.NUM))return c(f)}return"/"===f.val?e(f):w.eq(f.val,w.LOG)?h(f):w.eq(f.val,w.TRIG)?g(f):void 0}function b(b){var c,d,e=new q("*");return w.eq(b.right.val,w.NUM)?(d=b.right.val,c=a(b.left)):w.eq(b.left.val,w.NUM)&&(d=b.left.val,c=a(b.right)),1===c.val?new q(d):w.eq(c.val,w.NUM)?new q(d*c.val):c.left&&w.eq(c.left.val,w.NUM)?(c.left.val*=d,c):(e.l(d),e.r(c),e)}function c(a){var b=a.clone(),c=new q("*"),d=a.left.clone();if(w.eq(b.right.val,w.NUM)){var e=b.right.val--;c.l(e),1===b.right.val&&(b=b.left),c.r(b)}else c.l(b.right.clone()),b.right.left.val-=b.right.right.val,c.r(b);return f(c,d)}function d(b){var c=new q("+"),d=new q("*"),e=new q("*");return d.l(b.left),d.r(a(b.right)),e.l(b.right),e.r(a(b.left)),c.l(d),c.r(e),c}function e(b){var c=new q("/"),d=new q("-"),e=new q("^"),f=b.left,g=b.right,h=a(f),i=a(g),j=new q("*"),k=new q("*");1!==h.val?(j.l(g),j.r(h)):j=g,1!==i.val?(k.l(f),k.r(i)):k=f,d.l(j),d.r(k),w.eq(j,w.NUM)&&w.eq(k,w.NUM)&&(d=j.val-k.val);var l=new q("*");if(l.l(w.ANY),l.r(0),d.left.equals(l)||d.left.equals(l["switch"]())){var m=new q("*");m.l(-1),m.r(d.right),d=1===d.right.val?new q(-1):m}return d.right&&(d.right.equals(l)||d.right.equals(l["switch"]()))&&(d=d.left),e.l(g),e.r(2),c.l(d),c.r(e),c}function f(b,c){if(c.right){var d=new q("*"),e=a(c);if("1"!=e.val)return d.l(b),d.r(e),d}return b}function g(a){var b=(a.clone(),{sin:m("cos@@@"),cos:m("-1*sin@@@"),tan:m("(sec@@@)^2"),csc:m("-1*csc@@@*cot@@@"),sec:m("sec@@@*tan@@@"),cot:m("-1*(csc@@@)^2"),arcsin:m("1/(sqrt(1-@@@^2))"),arccos:m("-1/(sqrt(1-@@@^2))"),arctan:m("1/(1+(@@@^2))"),arccsc:m("-1/(abs(@@@)*sqrt(@@@^2-1))"),arcsec:m("1/(abs(@@@)*sqrt(@@@^2-1))"),arccot:m("-1/(1+@@@^2)")});if(b[a.val]){var c=b[a.val].clone();return c.replace(w.MARKER,a.right),f(c,a.right)}}function h(b){var c=new q("/");return w.eq(b.right,w.NUM)?new q(0):(c.l(a(b.right)),c.r(b.right),c)}function i(a){var b=new q("*"),c=new q("ln");return b.l(a.clone()),c.r(a.left),b.r(c),"e"===a.left.val&&(b=a.clone()),f(b,a.right)}function j(a){for(var b=0;b<a.length;b++)"-"===a.charAt(b)&&(0===b||"+*^/-(".indexOf(a.charAt(b-1))>-1)&&(a=__strings.replaceAt.call(a,b,"~"));return a}function k(a){var b=__strings.findChar.call(a,"("),c=__strings.findChar.call(a,")"),d=[];if(b.length!==c.length)throw"Mismatched Parentheses!";for(var e=b.length-1;e>=0;e--){for(var f=e;f>=0&&b[e]<c[f];)f--;d.push([b.pop(),c.splice(f+1,1)[0]])}return d.reverse()}function l(a){function b(a,b){return a-b}function c(a,b){return Math.min.apply(Math,w.checkParens.map(function(c){return a+__strings.findChar.call(b,c)[0]||b.length+a}))}a=j(__strings.removeSpaces.call(a)).toLowerCase();var d=[],e=[];Object.keys(w.__FUNCTIONS).map(function(b){e=e.concat(__strings.findChar.call(a,b).map(function(a){return a+b.length}))}),e.sort(b);for(var f=e.length-1;f>=0;f--){var g=e[f],h=c(g,a.substring(e[f]));"("!==a[g]&&(a=__strings.splice.call(a,g,"("),a=__strings.splice.call(a,h+1,")"))}w.checkMultiply.map(function(b){d=d.concat(__strings.findChar.call(a,b))}),d.sort(b);for(var i=d.length-1;i>=0;i--){var l=d[i],m=a[l-1];(!isNaN(m)||")x".indexOf(m)>-1)&&(a=__strings.splice.call(a,l,"*"))}for(var n=__strings.findChar.call(a,"log"),o=n.length-1;o>=0;o--){var p,q=n[o],r=k(a),s=a.indexOf(",",q),t=a.substring(q+4,s),u=a.substring(s+1,a.indexOf(")",s));for(var v in r)if(r[v][0]===q+3){p=r[v][1];break}u=a.substring(s+1,p);var x="ln("+u+")/ln("+t+")";a=__strings.splice.call(__strings.cut.call(a,q,p),q,x)}return a}function m(a){if(""===a)return!1;a=l(a);for(var b=k(a),c=a;b[0]&&0===b[0][0]&&b[0][1]===a.length-1;)c=a=a.substring(1,a.length-1),b=k(a);for(var d in b){var e=b[d][0],f=b[d][1];a=a.substring(0,e)+Array(f-e+2).join("_")+a.substring(f+1)}for(var g={},h=a.length-1;h>=0;h--)for(var i in w.OPS)a.substring(h,h+i.length)===i&&(g[i]=h);var j,n;for(var o in w.OPS)if(g[o]>=0){j=g[o],n=a.substring(j,j+o.length);break}if(void 0===j)return new q(3===a.length&&x[a]?w[x[a]]:a.replace(/~/,"-"));var p=new q(n);return p.left=m(c.substring(0,j)),p.right=m(c.substring(j+n.length)),p}function n(a){var b=a.clone(),c=b;a.left&&a.left.equals(a.right)&&(c=p(a)),(c.equals(m("$$$+###"))||c.equals(m("$$$*###")))&&c["switch"]();for(var d in t[c.val]){var e=m(d);c.val===e.val&&c.equals(e)&&(c=t[c.val][d](c))}return c}function o(a){if(a instanceof q||(a=m(a)),!a.left&&!a.right)return a;var b=n(a);return b.equals(a)?(a.left&&(a.left=o(a.left)),a.right&&(a.right=o(a.right)),n(a)):o(b.clone()).equals(b)?b:o(o(b))}function p(a){for(var b in v)if(m(b).equals(a))return v[b](a);return a}function q(a){this.val=isNaN(a)?a:Number(a),this.left=!1,this.right=!1}function r(a){this.rule=a}function s(a){if(!a.left&&!a.right)return a.val;var b=s(a.right),c=s(a.left),d=a.val;return w.OPS[a.val]>w.OPS[a.right.val]&&(b="("+s(a.right)+")"),w.OPS[a.val]>w.OPS[a.left.val]&&(c="("+s(a.left)+")"),"*"===a.val&&"string"==typeof b&&w.checkMultiply.join("|").indexOf(b[0])>-1&&(d=""),"abs"===a.val&&(d="|",b+="|"),(c||"")+d+b}var t={"*":{"###*(###/$$$)":function(a){var b=new q("/");return b.l(a.left.val*a.right.left.val),b.r(n(a.right.right)),b},"(1/$$$)*($$$)":function(a){return a.left.left=a.right,a.left},"###*(###*$$$)":function(a){var b=new q("*");return b.l(a.left.val*a.right.left.val),b.r(n(a.right.right)),b},"###*($$$*###)":function(a){var b=new q("*");return b.l(a.left.val*a.right.right.val),b.r(n(a.right.left)),b},"$$$*(-1*$$$)":function(a){return a.right.left=a.left.clone(),a.left=new q(-1),a},"###*###":function(a){return new q(a.left.val*a.right.val)},"0*$$$":function(a){return new q(0)},"1*$$$":function(a){return a.right}},"+":{"###+###":function(a){return new q(a.left.val+a.right.val)},"(###*$$$)+(###*$$$)":function(a){if(a.left.right.equals(a.right.right)){var b=new q("*");return b.l(a.left.left.val+a.right.left.val),b.r(a.left.right),b}return a},"(cosx)^2+(sinx)^2":function(a){return new q(1)},"(sinx)^2+(cosx)^2":function(a){return new q(1)}},"-":{"###-###":function(a){return new q(a.left.val-a.right.val)},"$$$-(-1*$$$)":function(a){return a.val="+",a.right=a.right.right,a}},"/":{"$$$/1":function(a){return a.left},"($$$*(x^###))/(x^###)":function(a){var b=a.left.right.right.val,c=a.right.right.val;if(b>c)return a.left.right.right.val-=c,a.left;a.right.right.val-=b;var d=new q("/");return d.r(a.right),d.l(a.left.left),d},"(x^###)/(x^###)":function(a){var b=new q("/"),c=new q("*");return c.l(1),c.r(a.left),b.l(c),b.r(a.right),this["($$$*(x^###))/(x^###)"](b)},"###/>>>":function(a){var b=u.reciprocals[a.right.val],c=new q("*");return c.l(a.left),c.r(b),c.right.right=a.right.right,c},"###/(>>>^###)":function(a){var b=a.right.right,c=new q("*");return c.l(a.left),c.r("^"),c.right.left=a.right.left,c.right.left.val=u.reciprocals[a.right.left.val],c.right.right=b,c}},"^":{"x^1":function(a){return new q("x")},"x^0":function(a){return new q("1")},"($$$)^(1/2)":function(a){var b=new q("sqrt");return b.right=a.left,b},"(sqrt($$$))^2":function(a){return a.left.right},"(###*x)^(###)":function(a){return a.left.left.val=Math.pow(a.left.left.val,a.right.val),a.left}}},u={reciprocals:{sin:"csc",cos:"sec",tan:"cot",csc:"sin",sec:"cos",cot:"tan"}},v={"$$$+$$$":function(a){var b=new q("*");return b.l(2),b.r(a.right),b},"$$$*$$$":function(a){var b=new q("^");return b.l(a.left),b.r(2),b}};__strings={splice:function(a,b){return this.slice(0,a)+b+this.slice(a)},cut:function(a,b){return this.substring(0,a)+this.substring(b+1)},replaceAt:function(a,b){return this.substring(0,a)+b+this.substring(a+b.length)},findChar:function(a){for(var b=[],c=0;c<this.length;c++)this.substring(c,c+a.length)===a&&b.push(c);return b},removeSpaces:function(){return this.trim().replace(/\s+/g,"")}},q.prototype.getDir=function(a){return a=""+a,a=parseInt(a)>=1||"r"===a.toLowerCase()||"right"===a.toLowerCase()?"right":"left"},q.prototype.add=function(a,b){if(0===b||b){a=this.getDir(a);for(var c=this;c[a];)c=c[a];b instanceof q?c[a]=b:c[a]=new q(b)}},q.prototype.r=function(a){this.add(1,a)},q.prototype.l=function(a){this.add(-1,a)},q.prototype.equals=function(a){if(!a||!w.eq(this.val,a.val))return!1;var b,c;return b=c=!0,this.left&&a.left&&(b=a.left.equals(this.left)),this.right&&a.right&&(c=a.right.equals(this.right)),b&&c},q.prototype.clone=function(){var a=new q(this.val),b=this.left,c=this.right;return b&&(a.left=b.clone()),c&&(a.right=c.clone()),a},q.prototype["switch"]=function(){var a=this.right;return this.right=this.left,this.left=a,this},q.prototype.contains=function(a){var b,c;return b=c=!1,a instanceof q&&this.equals(a)||w.eq(this.val,a)?!0:(this.left&&(b=this.left.contains(a)),this.right&&(c=this.right.contains(a)),b||c)},q.prototype.replace=function(a,b){if(w.eq(this.val,a)){if(b instanceof q)return this.val=b.val,this.l(b.left),void this.r(b.right);this.val=b}return this.left&&this.left.replace(a,b),this.right&&this.right.replace(a,b),this},q.prototype.toString=function(a){a||(a=2);var b=Array(a+1).join(".")+this.left.toString(a+2),c=Array(a+1).join(".")+this.right.toString(a+2);return this.left||(b=""),this.right||(c=""),"["+this.val+"]\n"+b+c},q.prototype.toFlatString=function(){var a=this.left?this.left.toFlatString():"",b=this.right?this.right.toFlatString():"";return a+""+this.val+b};var w={};r.prototype.toString=function(){return this.rule};var x={$$$:"ANY","###":"NUM","&&&":"OP",">>>":"TRIG","@@@":"MARKER",",,,":"LOG","|||":"FRAC"};for(var y in x)w[x[y]]=new r(y);var z={"###":1,"&&&":"+",">>>":"sin","@@@":"@@@",",,,":"ln"};w.__OPS={"+":1,"-":1,"*":2,"/":2,"^":3},w.__FUNCTIONS={arcsin:4,arccos:4,arctan:4,arccsc:4,arcsec:4,arccot:4,sin:5,cos:5,tan:5,csc:5,sec:5,cot:5,ln:6,log:6,abs:7,sqrt:7},w.OPS={};for(var A in w.__OPS)w.OPS[A]=w.__OPS[A];for(var A in w.__FUNCTIONS)w.OPS[A]=w.__FUNCTIONS[A];return w.checkMultiply=["(","x"].concat(Object.keys(w.__FUNCTIONS)),w.checkParens=[")"].concat(Object.keys(w.__FUNCTIONS)).concat(Object.keys(w.__OPS)),w.fns={"###":function(a){return a instanceof q?!isNaN(a.val)||!isNaN(a.left.val)&&!isNaN(a.right.val):!isNaN(a)},"&&&":function(a){return a&&"+-/*^".indexOf(a)>-1},">>>":function(a){return a&&"sin|cos|tan|csc|sec|cot|arcsin|arccos|arctan|arccsc|arcsec|arccot".indexOf(a)>-1},"@@@":function(a){return"@@@"===a},",,,":function(a){return a&&"ln|log".indexOf(a)>-1},"|||":function(a){return a instanceof q&&"/"===a.val&&isNaN(a.left)&&isNaN(a.right)}},w.eq=function(a,b){if(b==w.ANY||a==w.ANY)return!0;if(a instanceof r){var c=b;b=a,a=c}return a instanceof r&&(z[a]?a=z[a]:console.log("No "+a)),this.fns[b.rule]?this.fns[b.rule](a):(a instanceof q&&(a=a.val),a==b)},{derive:function(b){return this.simplify(a(b))},parse:m,simplify:function(a){return s(o(a))},_derive:a,_equals:w.eq}}();